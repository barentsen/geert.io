
<!DOCTYPE html>
<html lang="en">
<head>
  <link href='//fonts.googleapis.com/css?family=Source+Sans+Pro:300,400,700,400italic' rel='stylesheet' type='text/css'>

    <link rel="stylesheet" type="text/css" href="https://www.geert.io/theme/stylesheet/style.min.css">

  <link rel="stylesheet" type="text/css" href="https://www.geert.io/theme/pygments/github.min.css">
  <link rel="stylesheet" type="text/css" href="https://www.geert.io/theme/font-awesome/css/font-awesome.min.css">

    <link href="https://www.geert.io/static/geert.css" rel="stylesheet">

    <link href="https://www.geert.io/feeds/all.atom.xml" type="application/atom+xml" rel="alternate" title="Geert Barentsen Atom">



  <meta charset="utf-8" />
  <meta http-equiv="X-UA-Compatible" content="IE=edge" />
  <meta name="HandheldFriendly" content="True" />
  <meta name="viewport" content="width=device-width, initial-scale=1.0" />
  <meta name="robots" content="" />


<meta name="author" content="Geert" />
<meta name="description" content="I regularly open huge images and tables (>1 GB) in interactive Java-based (astronomy) software such as Aladin and TopCat. Because of the way memory allocation works in Java, the area where objects reside in memory (called the heap) needs to be reserved up front using Java's -Xmx switch. Hence I …" />
<meta name="keywords" content="Aladin, Java, Topcat">
<meta property="og:site_name" content="Geert Barentsen"/>
<meta property="og:title" content="Is Java freezing your system? Tune the garbage collector!"/>
<meta property="og:description" content="I regularly open huge images and tables (>1 GB) in interactive Java-based (astronomy) software such as Aladin and TopCat. Because of the way memory allocation works in Java, the area where objects reside in memory (called the heap) needs to be reserved up front using Java's -Xmx switch. Hence I …"/>
<meta property="og:locale" content="en_US"/>
<meta property="og:url" content="https://www.geert.io/java-freezing-due-to-garbage-collector.html"/>
<meta property="og:type" content="article"/>
<meta property="article:published_time" content="2013-03-26 00:00:00-07:00"/>
<meta property="article:modified_time" content=""/>
<meta property="article:author" content="https://www.geert.io/author/geert.html">
<meta property="article:section" content="computing"/>
<meta property="article:tag" content="Aladin"/>
<meta property="article:tag" content="Java"/>
<meta property="article:tag" content="Topcat"/>
<meta property="og:image" content="https://pbs.twimg.com/profile_images/683734803133235200/NogCr1RI_400x400.jpg">

  <title>Geert Barentsen &ndash; Is Java freezing your system? Tune the garbage collector!</title>

</head>
<body>
  <aside>
    <div>
      <a href="/">
        <img src="https://pbs.twimg.com/profile_images/683734803133235200/NogCr1RI_400x400.jpg" alt="Geert Barentsen" title="Geert Barentsen">
      </a>
      <h1><a href="https://www.geert.io">Geert Barentsen</a></h1>

<p>Scientist & Software Engineer</p>
      <nav>
        <ul class="list">
          <li><a href="/">home</a></li>
          <li><a href="/pages/about.html">about me</a></li>
          <li><a href="https://scholar.google.com/citations?user=oj_-lW4AAAAJ&hl=en">publications</a></li>
        </ul>
      </nav>

      <ul class="social">
        <li><a class="sc-linkedin" href="https://www.linkedin.com/in/barentsen" target="_blank"><i class="fa fa-linkedin"></i></a></li>
        <li><a class="sc-twitter" href="https://twitter.com/geerthub" target="_blank"><i class="fa fa-twitter"></i></a></li>
        <li><a class="sc-github" href="https://github.com/barentsen" target="_blank"><i class="fa fa-github"></i></a></li>
        <li><a class="sc-rss" href="/feeds/all.atom.xml" target="_blank"><i class="fa fa-rss"></i></a></li>
      </ul>
    </div>


  </aside>
  <main>


<article class="single">
  <header>
    <h1 id="java-freezing-due-to-garbage-collector">Is Java freezing your system? Tune the garbage collector!</h1>
    <p>
          Posted on Tue 26 March 2013 in <a href="https://www.geert.io/category/computing.html">computing</a>


    </p>
  </header>


  <div>
    <p>I regularly open huge images and tables (&gt;1 GB) in interactive Java-based
(astronomy) software such as <a class="reference external" href="http://aladin.u-strasbg.fr/">Aladin</a> and <a class="reference external" href="http://www.star.bris.ac.uk/~mbt/topcat/">TopCat</a>. Because of <a class="reference external" href="http://www.ibm.com/developerworks/java/library/j-nativememory-linux/">the
way memory allocation works in Java</a>, the area where objects reside in
memory (called the heap) needs to be reserved up front using Java's
<code>-Xmx</code> switch. Hence I tend to run memory-intensive applications
using:</p>
<div class="highlight"><pre><span></span>java -Xmx4000m
</pre></div>
<p>If you don't use this flag you will get an <code>OutOfMemoryError</code>
exception as soon as your application exceeds the default heap size,
which is typically set at only a few hundred megabytes.</p>
<p>However, I frequently found myself faced with a horrible performance
experience when using a large heap. Java applications would freeze my
entire (64-bit) Linux system for anywhere between 2 and 60 seconds. This
happened regardless of the JVM used (I tried Oracle Java 1.7, Sun Java
1.6, GCJ 1.5). I verified that my system had plenty of memory available
and was not swapping, hence a lack of memory was not to blame. A
profiler revealed that these freezes were instead caused by an insane
number of interrupts which ate 100% of all CPU cores in so-called
&quot;system&quot; cycles.</p>
<p>The cause of these system freezes is Java's garbage collection
mechanism; a built-in automated memory management system which reclaims
memory occupied by objects that are no longer in use. Whilst this
feature makes programming in Java a bit easier than, say, C++; it comes
with the disadvantage that garbage collection in a large heap can
<a class="reference external" href="http://stackoverflow.com/questions/214362/java-very-large-heap-sizes">introduce a considerable overhead</a>. Some collection algorithms deal
less effectively with large heaps than others, and unfortunately in my
case, Java appeared to be using a collection strategy which paused the
application during the whole duration of each garbage collection run,
hence resulting in frequent freezing.</p>
<p>The trick to avoid these freezes is to tell Java to use a collection
strategy which runs concurrently to the application, hence avoiding
lengthy interruptions of the entire process. This can be achieved using
the <code>-XX:+UseConcMarkSweepGC</code> flag, i.e.:</p>
<div class="highlight"><pre><span></span>java -Xmx4000m -XX:+UseConcMarkSweepGC
</pre></div>
<p>There are in fact <a class="reference external" href="http://www.oracle.com/technetwork/java/javase/gc-tuning-6-140523.html#cms">many more</a> tuning parameters which can influence the
behaviour of the garbage collection, but <code>UseConcMarkSweepGC</code> looks like
the first obvious thing to try if you are experiencing annoying freezes
in memory-intensive Java applications.</p>

  </div>
  <div class="tag-cloud">
    <p>
      <a href="https://www.geert.io/tag/aladin.html">Aladin</a>
      <a href="https://www.geert.io/tag/java.html">Java</a>
      <a href="https://www.geert.io/tag/topcat.html">Topcat</a>
    </p>
  </div>




<div id="disqus_thread"></div>
<script type="text/javascript">
    var disqus_shortname = 'geert';
    (function() {
        var dsq = document.createElement('script'); dsq.type = 'text/javascript'; dsq.async = true;
        dsq.src = '//' + disqus_shortname + '.disqus.com/embed.js';
        (document.getElementsByTagName('head')[0] || document.getElementsByTagName('body')[0]).appendChild(dsq);
    })();
</script>
<noscript>
        Please enable JavaScript to view comments.

</noscript>
</article>

    <footer>
<p>&copy; Geert Barentsen 
—
powered by <a href="http://getpelican.com">Pelican</a>
—
you can <a href="https://github.com/alexandrevicenzi/flex">fork this theme</a> on GitHub.
</p>    </footer>
  </main>

<!-- Google Analytics -->
<script type="text/javascript">
  (function(i,s,o,g,r,a,m){i['GoogleAnalyticsObject']=r;i[r]=i[r]||function(){
  (i[r].q=i[r].q||[]).push(arguments)},i[r].l=1*new Date();a=s.createElement(o),
  m=s.getElementsByTagName(o)[0];a.async=1;a.src=g;m.parentNode.insertBefore(a,m)
  })(window,document,'script','//www.google-analytics.com/analytics.js','ga');

  ga('create', 'UA-69171-3', 'auto');
  ga('send', 'pageview');
</script>
<!-- End Google Analytics -->



<script type="application/ld+json">
{
  "@context" : "http://schema.org",
  "@type" : "Blog",
  "name": " Geert Barentsen ",
  "url" : "https://www.geert.io",
  "image": "https://pbs.twimg.com/profile_images/683734803133235200/NogCr1RI_400x400.jpg",
  "description": ""
}
</script>
</body>
</html>